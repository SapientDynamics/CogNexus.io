version: 1
applications:
  # Main CogNexus.io platform app
  - appRoot: apps/cognexus
    frontend:
      phases:
        preBuild:
          commands:
            - cd ../..
            - npm install -g pnpm
            - pnpm install
        build:
          commands:
            - pnpm --filter ./apps/cognexus build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*
    
  # Forge vertical app
  - appRoot: apps/forge
    frontend:
      phases:
        preBuild:
          commands:
            - cd ../..
            - npm install -g pnpm
            - pnpm install
        build:
          commands:
            - pnpm --filter ./apps/forge build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*

# This configuration file is used by AWS Amplify to build and deploy the monorepo.
# It defines separate build configurations for each Next.js app in the monorepo.
# The preBuild phase installs pnpm and dependencies at the root level.
# The build phase uses pnpm filtering to build only the specific app.
# Artifacts are collected from the .next directory of each app.
# Cache paths are specified to improve build performance.
