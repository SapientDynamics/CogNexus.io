version: 1
# Amplify Hosting build configuration for the Forge app.
# This file lives in apps/forge/, so the 'frontend' section applies directly
# to this app without needing an 'applications' array or an appRoot.
frontend:
  phases:
    preBuild:
      commands:
        # Enable Corepack and pin pnpm for reproducible CI builds
        - corepack enable
        - corepack prepare pnpm@10.15.0 --activate
        # Install from the monorepo root so workspace deps and shared packages are linked
        # The working directory for this build is apps/forge, so the repo root is ../..
        - pnpm -C ../.. install --frozen-lockfile -w
        # If shared packages in the monorepo require a build step before the app build,
        # uncomment the following line to build them at the workspace root:
        # - pnpm -C ../.. -w build
    build:
      commands:
        # Build the Next.js app (SSR artifacts will be emitted into .next)
        - pnpm build
  artifacts:
    # For Next.js SSR on Amplify Hosting, deploy from the .next directory
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      # Cache pnpm store and Next.js build cache to speed up subsequent builds
      - ../../.pnpm-store/**/*
      - .next/cache/**/*
